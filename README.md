## High level implementation scheme

```
                           +-----------------+
                           |                 |
                           | `RpcConnection` +<---------------+
                           |                 |                |
                           +--------+--------+                |
                                    |                         |
                                    |                         |
                                    v                         |
                              +-----+-----+                   |
                              |           |                   |
                              | `Command` |                   |
                              |           |                   |
                              +-----+-----+                   |
                                    |                         |
                                    |                         |
                                    v                         |
                          +---------+----------+          +---+-----+
                          |                    |          |         |
            +-------------+ `SnapshotResolver` +--------->+ `Event` |
            |             |                    |          |         |
            |             +---------+----------+          +---------+
            |                       ^
            |                       |
            v                       |
+-----------+------------+          |           +---------------------+
|                        |          |           |                     |
| Command Actix messages |          +-----------+ `send_event(Event)` |
|                        |                      |                     |
+-----------+------------+                      +----------+----------+
            |                                              ^
            |                                              |
            |                                              |
            |                   +--------+                 |
            |                   |        |                 |
            +------------------>+ `Room` +-----------------+
                                |        |
                                +--------+

```

## `SnapshotResolver` implementation

```
                                   +--------------------------+                 +------------------+               +--------------+
                                   |                          |                 |                  |               |              |
                                   | `Command::SynchronizeMe` |              +--+ Normal `Command` |               | Send `Event` |
                                   |                          |              |  |                  |               |              |
                                   +--------------+-----------+              |  +------------------+               +--------+-----+
                                                  |                          |                                              ^
                                                  |                          |                                              |
                                                  |                          |                                              |
+-------------------------------------------------------------------------------------------------------------------------------+
|                                                 |                          |                                              |   |
|                                                 v                          |                        `SnapshotResolver`    |   |
|  +-----------------------------+   +------------+--------------------+     |                                              |   |
|  |                             |   |                                 |     |                                              |   |
|  | Wait until all `Command`s   +<--+ Mark that `Snapshot` is syncing |     |                                              |   |
|  | will be processed by `Room` |   |                                 |     |                                              |   |
|  |                             |   +------------+--------------------+     |                                              |   |
|  +------------+----------------+                |                          |  +-----------------+                         |   |
|               |                                 v                          |  |                 |                         |   |
|               v                           +-----+------------------------+ |  |                 v                         |   |
|  +------------+-----------------------+   |                              | |  |  +--------------+-------------+           |   |
|  |                                    |   | Extract `Command`s from diff | |  |  |                            |     No    |   |
|  | Set snapshot sync state to `false` |   |                              | |  |  | Is Snapshot in sync state? +-----------+   |
|  |                                    |   +-------+----------------------+ |  |  |                            |               |
|  +------------+-----------------------+           |                        |  |  +----------------------+-----+               |
|               |                                   |                        |  |                         ^                     |
|               v                          -------------------------------------+                         |                     |
|  +------------+-----------------------+  |        |                        |     +-----------------+    |                     |
|  |                                    |  |        |        +-----------+   |     |                 |    |                     |
|  | Send `Event::SnapshotSynchronized` +--+        |        |           |   |     | Update Snapshot |    |                     |
|  |                                    |           +------->+ `Command` +<--+     |                 |    |                     |
|  +------------------------------------+                    |           |         +----+------------+    |                     |
|                                                            +-----+-----+              ^                 |                     |
|                                                                  |                    |                 |                     |
+-------------------------------------------------------------------------------------------------------------------------------+
                                                                   |                    |                 |
                                                                   |                    |                 |
                                                                   |                    |                 |
                                                                   v                    |                 |
                                                              +----+---+          +-----+---+             |
                                                              |        |          |         |             |
                                                              | `Room` +--------->+ `Event` +-------------+
                                                              |        |          |         |
                                                              +--------+          +---------+
```